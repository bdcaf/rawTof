---
title: "Example usage or rawTof"
author: "Clemens Ager"
date: "`r Sys.Date()`"
output: 
  rmarkdown:::html_vignette
vignette: >
  %\VignetteIndexEntry{Example Usage}
  %\VignetteKeyword{example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Example usage

This vignette works with sample data provided by the
[tofExampleData](http://github.com/bdecaf/tofExampleData) package.

```{r, include = F}
devtools::load_all()
```


```{r}
tof_file <- system.file("extdata","breath.h5", package="tofExampleData")
```

The package requires [rhdf5](https://bioconductor.org/packages/release/bioc/html/rhdf5.html).
```{r library}
library(rawTof)
```

## Getting the peak data

```{r}
peaktable <- get_peak_matrix(tof_file)
plot(peaktable[ "69-(C5H8)H+ (100.00%) 69.0698776245117" , ], type="l", ylab="m/z 69 (Isoprene)")
plot(peaktable["59-(C3H6O)H+ (100.00%) 59.0491409301758", ], type="l", ylab="m/z 59 (Acetone)")
```


## Getting individual scans and the sum spectrum


### obtaining the mass calibration

### getting the sum spectrum
```{r}
ss <- get_sum_spec(tof_file)/180
plot(ss, type="l")
```

```{r}
s2 <- get_single_scan(tof_file, 31)
plot(s2, type="l")
```

```{r}
mh <- masscal_helper(tof_file)
mass_scale <- mh$to_mass(seq_along(ss))
```

### Plotting

```{r}
plot(mass_scale, s2, type="l")
lines(mass_scale, ss, col="red")
```

#### extracting a mass range
```{r}
mass_range <- mh$to_index(c(40, 50))
selected <- seq(from = floor(mass_range[1]),
                to = ceiling(mass_range[2]))

plot(mass_scale[selected], s2[selected], type="l")
lines(mass_scale[selected], ss[selected], col="red")
```
